# 0530版本总结
这个迭代主要进行了评级数据页面的开发，主要用来进行一些简单的统计。还有一些bug的处理，销售面板页面的新需求。

## 不要过分追求最高版本的框架
由于这个迭代的开发时间是充裕的，接口又迟迟没有做好，所以我这边为了节省时间，了解了下新的页面需求，并且开始简单的重构。

新的页面要求具有一个拖拽的功能，所以我很快就从github上面找到了一个不错的组件[*react-beautiful-dnd*](https://github.com/atlassian/react-beautiful-dnd)。此时的dnd组件已经是v7.0.0版本，要求react的版本是v16+。
在引用组件之后我很快发现了我的*react-imvc*框架中使用的react版本是v15.6+的。

于是看了react v15 ~ v16的API变更，然后希望通过变更*react-imvc*的react版本来解决此问题，结果单元测试一直不过，自己又没有足够长的时间去搞明白为什么会出现问题。

我转换了思路，用低版本的dnd组件（v6.0.0）来完成功能。这条路确实让我很快的完成了功能。

后来我思考我的选择，自己的思想确实太狭窄。为了单纯的追求完美使用高版本，这样带来的问题可能导致项目下的其他组件不兼容。可能会导致一系列的问题。要在项目顺利运行的前提下再对项目进行优化和版本提升。

但是换个方向思考，对于一个基于react的框架，我们也应该对框架进行一些迭代。一来是为了能够让新创建的项目使用较新的框架，新的框架可能有bugfix并且有效率上的提升，不仅是react，可能基于react的组件也有变更。再者也是能够对自身的问题解决，使自己的框架更加完美（不得不吐槽，*react-imvc*使用的还是webpack 1.0+，没有热更新，没有良好的样式解决方案...）。

## 调用接口重定向到登录页（cookie & session问题）
后端的同事在这个迭代开放了几个新的接口，但是我这边调用起来返回的结果竟然是登录页面的HTML。
很明显后端做了重定向，而且可以猜出来应该是身份校验没有过。
所以我向后端同事确认了一下，身份验证后端是如何做的，答案是通过session。
很高兴我之前的后端工作经验给我带来了很大的帮助，我知道了自己是应该没有给到后端sessionId，而sessionId是存在cookie中的。
至于为什么没有把这个cookie给到后端呢？我查看了fat环境(http://a.b.c.d.com)的cookie，一部分cookie的域是整个域名(a.b.c.d.com)，其中就包含着sessionId。而我开的本地host(http://a.b.e.d.com)能在request header中携带的cookie只有 .d.com 域中的cookie。所以很明显cookie没有给全。

举个例子:
```javascript
fat环境(http://a.b.c.d.com)
  fat环境下的cookie:
    name            domain
    sessionId       a.b.c.d.com
    a               a.b.c.d.com
    b               .d.com
    c               .d.com
  fat发送请求能够携带的cookie:
    sessionId & a & b & c

dev环境(http://a.b.e.d.com)
  dev环境下的cookie:
    name            domain
    b               .d.com
    c               .d.com
    d               a.b.e.d.com
  dev发送请求能够携带的cookie:
    b & c & d

请求只能发送自己域下的cookie
```

解决方案有两种
1. 把fat环境cookie创建到dev环境中，通过在dev环境补充fat环境的cookie达到目的；
2. 在使用之前的node代理的时候，把完整的cookie发送给fat环境，替换掉host域名下的cookie，因为host域名下的cookie是不全的

其实这两种解决方案对前端的开发都及其不友好，但是在前后端分离初期，这也是没办法的事情。
后端还是需要把对外接口进行一层包装，用来提升前端的开发调试效率。
