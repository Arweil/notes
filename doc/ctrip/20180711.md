# 0711版本总结
时隔一个月的大版本迭代，本来是要0627上的，但是页面内容巨多，推迟到了0711的版本。有一种被PD追杀到天涯海角的感觉。

这个迭代主要是对定制师的一个核心页面，创建方案行程进行的重构。页面包括创建新行程，从行程库导入行程，给行程添加报价的核心功能。

## 时间预估
方案行程页之初是用jquery编写的，逻辑和交互相当繁琐，本着方便版本的维护与迭代，我们决定用React对页面进行重构。

一开始乍一看页面内容并不算多，基于之前此页面的开发时间，所以简单直接的评估了工作量大概要1个月完成。在加班加点的做到第三周的时候发现了各种不起眼的逻辑里面有着大量的隐藏逻辑。最后页面将近做了5周才把功能开发完毕并且提测。期间各种加班，真的相当之累。

为了避免这些问题，我下次应该在评估时间前先去了解页面的详细功能，不能因为业务非常急就乍一看页面，说了开发时间。

## 选择组件
在选择组件前一定要去测试组件的功能，github的star数目并不代表这个组件就一定非常好。

这个页面有一个富文本编辑器组件，当时在github上面找了一个star数目最多的组件，然后自己简单试了下功能就在项目中使用了。在提测阶段，这个组件没有完成一些功能，我又去花费时间去寻找这个组件的bug原因，最终找了另外的组件，重新修改代码。足足耗费2天时间。

所以在选择组件前还是要了解需求是什么样的，组件是否都满足功能，并且良好运行，然后再去尝试使用。否则切换组件带来的是极大的时间浪费。因为你要重新学习新组件的API，并且按要求修改你的代码。

## React的优化和简单理解
因为项目开发时间非常紧，页面的数据量又非常大，所以没有对代码进行良好的优化。幸运的是，项目刚上线，我就对此开始着手处理，在项目上线两天后，PD就跑过来找我说有性能问题，所以性能问题得到了很快的优化，没有过多的印象线上的使用。

在React中能给项目性能提升最大的应该当属SCU(shouldComponentUpdate)优化，在React中，父级组件的数据变更带来的将是所有子组件的Render执行，虽然React有diff算法，但是diff算法只针对于DOM是否变更做的优化，Render该执行还是执行。SCU能够是你在组件渲染前进行一些数据比较，从而判断此组件是否需要执行Render方法。这对于深层次的数据结构与组件嵌套简直是必不可少的。

感觉很美好，但是可以想象的到为项目做SCU优化简直就是给自己埋坑:
1. 做SCU一般都会判断props，state是否有变化。如果组件需要额外拓展props，那么你的SCU也要响应的变更。
2. 莫名其妙的错误会接踵而至，比如这个项目用的antd的验证([rc-form](https://github.com/react-component/form#note-use-wrappedcomponentref-instead-of-withref-after-rc-form140))最后在保存验证的时候无法使子组件进行渲染显示出错误信息。所以我要在子组件每一层都要判断该组件是否验证通过。
3. 当然，你使用SCU还要注意deepcopy的问题，因为对象比较是特殊的，修改对象会在之前的结构上改，而不是生成一块新的内存在新的结构上更改。这种设计在节省内存的同时也带了的问题，那就是对象比较。所以React在state赋值时都要去赋一个深拷贝的对象，这样子组件才能比对出新的props和旧的props之间的差异。很明显，层级过多的深拷贝同样带来的性能问题。这时候immutable来了，他提供了一套全新的API来解决深浅拷贝的问题，并且算法效率很高。这无疑也增加了你的学习成本和团队的工作成本。（总是能有人写出奇葩的代码）

所以个人感觉SCU是一粒强效避孕药，他在给你性能提升的同时，带来很强的副作用。所以，慎用！
