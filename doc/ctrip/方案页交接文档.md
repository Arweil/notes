## 方案页描述

方案页功能主要包括:

* 导入方案 (行程库导入方案)
* 创建方案 (从0开始录入方案)
* 攻略进入方案自动带入
* 方案快照 (方案同步，预览，历史方案快照，订单基本信息查看)
* 方案概况 (方案基本信息录入，方案特色编辑，[富文本编辑器](https://github.com/margox/braft-editor))
* 方案行程 (具体方案录入，方案删除，新增，修改(拖拽))
* 方案报价 (行程的具体报价)


## 文件介绍

### Controller

由于方案页逻辑较为复杂，模块较多，所以方案页对Controller层进行拆分，分为如下文件:

* Controller.js // 入口文件，使用combineController方法把各个子Ctrl连接到Controller中，页面的初始化模块
* CtrlImportScheme.js // 导入方案模块功能模块
* CtrlOrderInfo.js // 订单数据处理模块
* CtrlOrderResourceStatus.js // 订单资源处理模块
* CtrlSchemeData.js // 方案核心模块 行程处理 报价处理 (接口数据与业务逻辑耦合度较高所以没有分离)
* CtrlSchemeSnapshots.js // 方案快照模块功能
* CtrlSuggest.js // 页面所以推荐功能的接口以及数据绑定

### Component

* CardFormItem 公共组件，方案快照中类似“方案名称”这些项的排版
* ImportScheme 导入方案弹窗组件 搜索 + 表格
* OrderInfo 页面头部“订单号”一栏 + 导航
* SchemeDetail 行程方案组件
* SchemeNav 右下角悬浮“方案导航栏”组件
* SchemeOverview 方案概况组件
* SchemePrice 方案报价模块
* SchemeSnapshot 方案快照组件

### EnumMng

页面枚举值，方便配置，统一修改

### TypeMng

数据接口预定义，使用Object.seal使对象不可拓展，保证对象的数据结构稳定，增加代码的可维护性

### MapData

和业务相关的一些数据匹配操作 + 接口数据整合到Object.seal数据结构中


## 方案模块整体设计思路

符合MVC思想，具体如下：

* M 作为数据层，用于全局的数据存储，主要使用[relite](https://github.com/Lucifier129/relite)作为状态管理器
* C controller层，作为side effect副作用层，用来处理异步数据，业务逻辑，事件等
* V view层，作为页面的展示层

V和M层中没有任何副作用的代码，M层中的数据通过C层统一UPDATE_STATE（有些数据并没有进行深拷贝）

行程模块设计:

* 由于数据结构较深，在编辑数据的时候(onChange)会把数据带出，在Controller层进行数据的存储 Model层中的*schemeDataSource*字段。

* 为了方案行程顺序的变更，使用[react-beautiful-dnd](https://github.com/atlassian/react-beautiful-dnd)插件进行拖拽处理，拖拽后会触发DragEnd事件，对二维数组中的项顺序进行操作。

* 由于表单数量较多，且是动态。所以使用节流和SCU(shouldComponentUpdate)进行性能方面的优化，并且对form表单进行拆分，减少rc-form中数据变化导致的表单渲染。节流方面使用的是[react-component-debounce](https://github.com/fgfg163/react-component-debounce)插件，此插件能够专门对antd中的事件进行节流。SCU方面主要是判断两次数据是否变更，从而判断组件是否渲染。form拆分方面，每个行程中的子行程(机票，酒店，活动...)都作为一个form，使form粒度较小，form中fields数据变更就能最小限度的进行渲染，在保存时使用refs获取所有form，并对form进行校验。


